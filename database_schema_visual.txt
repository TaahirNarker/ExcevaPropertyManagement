PROPERTY MANAGEMENT SYSTEM - DATABASE SCHEMA VISUALIZATION
================================================================

ğŸ“Š ENTITY RELATIONSHIP OVERVIEW
================================================================

ğŸ¢ CORE ENTITIES
â”œâ”€â”€ ğŸ‘¤ Users (CustomUser)
â”‚   â”œâ”€â”€ ğŸ”‘ Primary Key: id
â”‚   â”œâ”€â”€ ğŸ“§ Unique: email
â”‚   â”œâ”€â”€ ğŸ·ï¸  Role-based access (basic_user â†’ superuser)
â”‚   â””â”€â”€ ğŸ” WebAuthn support for passkeys
â”‚
â”œâ”€â”€ ğŸ  Properties
â”‚   â”œâ”€â”€ ğŸ”‘ Primary Key: id (UUID)
â”‚   â”œâ”€â”€ ğŸ·ï¸  Auto-generated: property_code (PRO000001)
â”‚   â”œâ”€â”€ ğŸ”— Self-referencing: parent_property (for sub-properties)
â”‚   â”œâ”€â”€ ğŸ‘¤ Owner: ForeignKey to Users
â”‚   â””â”€â”€ ğŸ¢ Manager: ForeignKey to Users (optional)
â”‚
â”œâ”€â”€ ğŸ‘¥ Tenants
â”‚   â”œâ”€â”€ ğŸ”‘ Primary Key: id
â”‚   â”œâ”€â”€ ğŸ”— OneToOne: user (CustomUser)
â”‚   â”œâ”€â”€ ğŸ·ï¸  Auto-generated: tenant_code (TEN000001)
â”‚   â””â”€â”€ ğŸ†” Unique: id_number (Government ID)
â”‚
â”œâ”€â”€ ğŸ¦ Landlords
â”‚   â”œâ”€â”€ ğŸ”‘ Primary Key: id (UUID)
â”‚   â”œâ”€â”€ ğŸ“§ Unique: email
â”‚   â”œâ”€â”€ ğŸ¢ Types: Individual, Company, Trust
â”‚   â””â”€â”€ ğŸ¦ Banking information included
â”‚
â”œâ”€â”€ ğŸ“„ Leases
â”‚   â”œâ”€â”€ ğŸ”‘ Primary Key: id
â”‚   â”œâ”€â”€ ğŸ”— Property: ForeignKey to Properties
â”‚   â”œâ”€â”€ ğŸ”— Tenant: ForeignKey to Tenants
â”‚   â””â”€â”€ ğŸ’° Financial: monthly_rent, deposit_amount
â”‚
â”œâ”€â”€ ğŸ§¾ Invoices (Finance)
â”‚   â”œâ”€â”€ ğŸ”‘ Primary Key: id
â”‚   â”œâ”€â”€ ğŸ·ï¸  Auto-generated: invoice_number (INV-YYYY-NNNNNN)
â”‚   â”œâ”€â”€ ğŸ”— Lease: ForeignKey to Leases
â”‚   â”œâ”€â”€ ğŸ”— Property: ForeignKey to Properties
â”‚   â”œâ”€â”€ ğŸ”— Tenant: ForeignKey to Tenants
â”‚   â””â”€â”€ ğŸ”’ Locking system: is_locked, locked_at, locked_by
â”‚
â””â”€â”€ âš¡ Strike Invoices (Bitcoin Payments)
    â”œâ”€â”€ ğŸ”‘ Primary Key: id (UUID)
    â”œâ”€â”€ ğŸ”— Tenant: ForeignKey to Tenants
    â”œâ”€â”€ ğŸ”— Lease: ForeignKey to Leases (optional)
    â”œâ”€â”€ ğŸ’° Amount: amount_zar (ZAR)
    â””â”€â”€ ğŸ·ï¸  Status: pending â†’ paid

ğŸ“‹ SUPPORTING ENTITIES
================================================================

ğŸ“¸ Property Media
â”œâ”€â”€ Property Images
â”‚   â”œâ”€â”€ ğŸ”— Property: ForeignKey to Properties
â”‚   â”œâ”€â”€ ğŸ–¼ï¸  image_url, image_file
â”‚   â””â”€â”€ ğŸ·ï¸  is_primary, order
â”‚
â””â”€â”€ Property Documents
    â”œâ”€â”€ ğŸ”— Property: ForeignKey to Properties
    â”œâ”€â”€ ğŸ“„ document_type (deed, lease, insurance, etc.)
    â””â”€â”€ ğŸ‘¤ uploaded_by: ForeignKey to Users

ğŸ“‹ Tenant Records
â”œâ”€â”€ Tenant Documents
â”‚   â”œâ”€â”€ ğŸ”— Tenant: ForeignKey to Tenants
â”‚   â”œâ”€â”€ ğŸ“„ document_type (id_document, proof_of_income, etc.)
â”‚   â””â”€â”€ â° expires_at (optional)
â”‚
â””â”€â”€ Tenant Communications
    â”œâ”€â”€ ğŸ”— Tenant: ForeignKey to Tenants
    â”œâ”€â”€ ğŸ“ type (email, phone, sms, etc.)
    â””â”€â”€ ğŸ‘¤ created_by: ForeignKey to Users

ğŸ’° Financial Records
â”œâ”€â”€ Invoice Line Items
â”‚   â”œâ”€â”€ ğŸ”— Invoice: ForeignKey to Invoices
â”‚   â”œâ”€â”€ ğŸ“ description, category
â”‚   â””â”€â”€ ğŸ’° quantity, unit_price, total
â”‚
â”œâ”€â”€ Invoice Audit Log
â”‚   â”œâ”€â”€ ğŸ”— Invoice: ForeignKey to Invoices
â”‚   â”œâ”€â”€ ğŸ‘¤ User: ForeignKey to Users
â”‚   â”œâ”€â”€ ğŸ”„ action (created, updated, sent, locked, etc.)
â”‚   â””â”€â”€ ğŸ“¸ invoice_snapshot (JSON)
â”‚
â”œâ”€â”€ Invoice Templates
â”‚   â”œâ”€â”€ ğŸ‘¤ created_by: ForeignKey to Users
â”‚   â”œâ”€â”€ ğŸ“ from_details, to_details, default_notes
â”‚   â””â”€â”€ ğŸ“‹ default_line_items (JSON)
â”‚
â””â”€â”€ Invoice Payments
    â”œâ”€â”€ ğŸ”— Invoice: ForeignKey to Invoices
    â”œâ”€â”€ ğŸ’° amount, payment_method
    â””â”€â”€ ğŸ“… payment_date

âš¡ Bitcoin Payment Flow
â”œâ”€â”€ Lightning Quotes
â”‚   â”œâ”€â”€ ğŸ”— Strike Invoice: ForeignKey to Strike Invoices
â”‚   â”œâ”€â”€ ğŸ’° btc_amount, exchange_rate
â”‚   â”œâ”€â”€ âš¡ bolt11 (Lightning payment request)
â”‚   â””â”€â”€ â° expires_at (15 minutes)
â”‚
â”œâ”€â”€ Payment Transactions
â”‚   â”œâ”€â”€ ğŸ”— Strike Invoice: OneToOne to Strike Invoices
â”‚   â”œâ”€â”€ ğŸ”— Lightning Quote: ForeignKey to Lightning Quotes
â”‚   â”œâ”€â”€ ğŸ”— transaction_hash (Lightning transaction)
â”‚   â””â”€â”€ ğŸ·ï¸  status (pending, confirmed, failed)
â”‚
â””â”€â”€ Webhook Events
    â”œâ”€â”€ ğŸ“¡ event_type (invoice.created, invoice.paid, etc.)
    â”œâ”€â”€ ğŸ”— Strike Invoice: ForeignKey to Strike Invoices (optional)
    â””â”€â”€ ğŸ“Š raw_data (JSON), processed

ğŸ”— KEY RELATIONSHIPS
================================================================

ğŸ‘¤ USER HIERARCHY
Users (CustomUser)
â”œâ”€â”€ 1:1 â†’ Tenants (via user field)
â”œâ”€â”€ 1:N â†’ Properties (as owner)
â”œâ”€â”€ 1:N â†’ Properties (as property_manager)
â”œâ”€â”€ 1:N â†’ Invoices (as created_by)
â”œâ”€â”€ 1:N â†’ Invoices (as landlord)
â”œâ”€â”€ 1:N â†’ Invoice Audit Logs (as user)
â””â”€â”€ 1:N â†’ Invoice Templates (as created_by)

ğŸ  PROPERTY HIERARCHY
Properties
â”œâ”€â”€ 1:N â†’ Properties (self-referencing, parent_property)
â”œâ”€â”€ 1:N â†’ Property Images
â”œâ”€â”€ 1:N â†’ Property Documents
â”œâ”€â”€ 1:N â†’ Leases
â””â”€â”€ 1:N â†’ Invoices

ğŸ‘¥ TENANT RELATIONSHIPS
Tenants
â”œâ”€â”€ 1:1 â† Users (via user field)
â”œâ”€â”€ 1:N â†’ Tenant Documents
â”œâ”€â”€ 1:N â†’ Tenant Communications
â”œâ”€â”€ 1:N â†’ Leases
â””â”€â”€ 1:N â†’ Strike Invoices

ğŸ“„ LEASE RELATIONSHIPS
Leases
â”œâ”€â”€ N:1 â† Properties
â”œâ”€â”€ N:1 â† Tenants
â”œâ”€â”€ 1:N â†’ Invoices
â””â”€â”€ 1:N â†’ Strike Invoices

ğŸ§¾ INVOICE RELATIONSHIPS
Invoices
â”œâ”€â”€ N:1 â† Leases
â”œâ”€â”€ N:1 â† Properties
â”œâ”€â”€ N:1 â† Tenants
â”œâ”€â”€ N:1 â† Users (as created_by)
â”œâ”€â”€ N:1 â† Users (as landlord)
â”œâ”€â”€ 1:N â†’ Invoice Line Items
â”œâ”€â”€ 1:N â†’ Invoice Audit Logs
â”œâ”€â”€ 1:N â†’ Invoice Payments
â””â”€â”€ 1:N â†’ Invoices (self-referencing, parent_invoice)

âš¡ PAYMENT FLOW
Strike Invoices
â”œâ”€â”€ N:1 â† Tenants
â”œâ”€â”€ N:1 â† Leases (optional)
â”œâ”€â”€ 1:N â†’ Lightning Quotes
â”œâ”€â”€ 1:1 â†’ Payment Transactions
â””â”€â”€ 1:N â†’ Webhook Events

Lightning Quotes
â”œâ”€â”€ N:1 â† Strike Invoices
â””â”€â”€ 1:1 â†’ Payment Transactions

ğŸ”‘ UNIQUE CONSTRAINTS
================================================================

â€¢ Users.email (unique)
â€¢ Properties.property_code (unique, auto-generated)
â€¢ Tenants.tenant_code (unique, auto-generated)
â€¢ Tenants.id_number (unique)
â€¢ Landlords.email (unique)
â€¢ Invoices.invoice_number (unique, auto-generated)
â€¢ Strike Invoices.strike_invoice_id (unique)
â€¢ Lightning Quotes.quote_id (unique)
â€¢ Payment Transactions.transaction_hash (unique)
â€¢ Webhook Events.event_id (unique)

ğŸ·ï¸  AUTO-GENERATED CODES
================================================================

â€¢ Property Codes: PRO000001, PRO000002, ...
â€¢ Tenant Codes: TEN000001, TEN000002, ...
â€¢ Invoice Numbers: INV-2024-000001, INV-2024-000002, ...

ğŸ”’ BUSINESS RULES
================================================================

â€¢ One active lease per property at a time
â€¢ One invoice per tenant per month (Bitcoin payments)
â€¢ Sub-properties inherit address from parent property
â€¢ Invoice locking prevents further edits
â€¢ Payment quotes expire after 15 minutes
â€¢ VAT numbers must be 10 digits (companies)
â€¢ ID numbers must be 13 digits (individuals)
â€¢ Square meters must be positive

ğŸ¨ COLOR CODING (in visual diagram)
================================================================

ğŸŸ  Orange: User-related entities (Users, Landlords)
ğŸ”µ Cyan: Property-related entities (Properties, Images, Documents)
ğŸŸ£ Pink: Tenant-related entities (Tenants, Documents, Communications, Leases)
ğŸŸ¢ Green: Financial entities (Invoices, Line Items, Audit Log, Templates, Payments)
ğŸ”´ Red: Payment/Bitcoin entities (Strike Invoices, Lightning Quotes, Transactions, Webhooks)

ğŸ“Š DATABASE STATISTICS
================================================================

Total Tables: 18
â€¢ Core Entities: 7
â€¢ Supporting Entities: 11
â€¢ Self-referencing Relationships: 2 (Properties, Invoices)
â€¢ Foreign Key Relationships: 25+
â€¢ Unique Constraints: 10
â€¢ Auto-generated Fields: 3

ğŸ”§ TECHNICAL DETAILS
================================================================

â€¢ Database: PostgreSQL 13+
â€¢ ORM: Django
â€¢ Primary Keys: UUID (for main entities), Integer (for supporting entities)
â€¢ Timestamps: created_at, updated_at (auto-generated)
â€¢ Soft Deletes: Not implemented (hard deletes with CASCADE)
â€¢ Indexes: Performance indexes on frequently queried fields
â€¢ JSON Fields: Used for flexible data (features, preferences, snapshots)
â€¢ File Storage: URL fields + FileField for uploads

ğŸ“ˆ SCALABILITY FEATURES
================================================================

â€¢ UUID primary keys for main entities
â€¢ Proper indexing strategy
â€¢ JSON fields for flexible data
â€¢ Audit logging for compliance
â€¢ Webhook system for real-time updates
â€¢ Role-based access control
â€¢ Multi-currency support (ZAR + BTC)
â€¢ Hierarchical property structure 